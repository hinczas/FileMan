@model FileMan.Models.ViewModels.MasterFileViewModel
@using FileMan.Models;
@using FileMan.Models.ViewModels;
@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/jqueryval")
@{
    ViewBag.Title = "File";
}

<style>
    .row {
        padding-top: 15px;
    }

    .col-md-3, .col-md-9 {
        padding: 0px;
    }

    .icon {
        max-width: 16px;
        max-height: 16px;
    }
    textarea, #nameInput {
        max-width:900px;
        width:100%;
    }
</style>

<div class="row">
    <div class="col-md-3">
        <div class="col-md-12">
            <div class="panel panel-info">
                <div class="panel-heading">Collections</div>
                <div class="panel-body" style="white-space:nowrap; overflow-x:auto;">
                    @foreach (TreeNode node in Model.TreeNodes)
                    {
                        <p style="text-indent:@(node.Indent*20)px; margin-bottom:5px;">
                            @Html.ActionLink(node.Branch.Name, "Index", "Home", new { id = node.Branch.Id }, new { title = "Parent" }) 
                            @if (@node.Branch.Files.Count > 0)
                            {
                                <span class="badge" style="text-indent:0px;">@node.Branch.Files.Count()</span>
                            }
                        </p>
                    }
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-9">
        <div class="col-md-12">
            <ol class="breadcrumb" style="margin-bottom:10px;">
                @if (@Model.Breadcrumbs != null || @Model.Breadcrumbs.Count() > 0)
                {
                    for (int i = @Model.Breadcrumbs.Count() - 1; i >= 0; i--)
                    {
                        <li>@Html.ActionLink(Model.Breadcrumbs.ElementAt(i).Name, "Index", "Home", new { id = Model.Breadcrumbs.ElementAt(i).Id }, new { title = "Parent" })</li>
                    }
                }
                <li class="active">@Model.Current.Name</li>
            </ol>
        </div>
        <div class="col-md-12">
            @using (Html.BeginForm("Edit", "MasterFiles", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post, new { @class = "form-horizontal", role = "form", enctype = "multipart/form-data" }))
            {
                @Html.AntiForgeryToken()
                <div class="panel panel-success">
                    <div class="panel-heading">
                        <div class="container" style="align-items:center; width:100%; padding:0px;">
                            <h3 style="margin-top:0; margin-bottom:0px;float:left; padding-top:3px;">
                                <b>@Model.Current.Number</b> - @Model.DraftVersion - @Model.Current.Name
                            </h3>
                            <div class="btn-group btn-group-sm pull-right" role="group" style="float:right;margin-top:0px;">
                                @Html.ActionLink("Cancel", "Details", "MasterFiles", new { id = Model.Current.Id }, new { @class = "btn btn-sm btn-default", type = "button" })
                                <input type="submit" value="Save" class="btn btn-sm btn-success" />
                            </div>
                        </div>
                        <span style="float:right;">

                        </span>
                    </div>
                    <table class="table table-striped table-hover table-condensed">
                        <thead>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="font-weight:700; width:100px;" align="right">Name</td>
                                <td> <input type="text" class="form-control" name="Name" value="@Model.Current.Name" id="nameInput" /></td>
                            </tr>
                            <tr>
                                <td style="font-weight:700; width:100px;" align="right">Description</td>
                                <td><span style="white-space: pre-line"><textarea rows="5" cols="10" class="form-control" name="Description" placeholder="Description...">@Model.Current.Description</textarea></span> </td>
                            </tr>
                            <tr>
                                <td style="font-weight:700; width:100px;" align="right">Comment</td>
                                <td><span style="white-space: pre-line"><textarea rows="3" cols="10" class="form-control" name="Comment" placeholder="Comment...">@Model.Current.Comment</textarea></span> </td>
                            </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="Id" value="@Model.Current.Id" />
                    <input type="hidden" name="Number" value="@Model.Current.Number" />
                </div>
            }

            <div class="panel panel-info">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        Latest revisions
                    </h4>
                </div>
                <table class="table table-striped table-hover table-condensed">
                    <thead>
                        <tr>
                            <th style="font-weight:900; width:50px;" align="right">Type</th>
                            <th style="font-weight:900; width:250px;" align="right">Comment</th>
                            <th style="font-weight:900; width:130px;" align="right">Added</th>
                            <th style="font-weight:900; width:25px;" align="right"></th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (@Model.LatestIssue != null)
                        {
                            <tr>
                                <td><span class="label label-success">Issue</span> @Model.LatestIssue.Draft</td>
                                <td>@Model.LatestIssue.Comment</td>
                                <td>@Model.LatestIssue.Added</td>
                                <td>@Html.ActionLink("download", "GetFile", "FileRevisions", new { id = Model.LatestIssue.Id }, null)</td>
                            </tr>
                        }
                        @if (@Model.LatestDraft != null)
                        {
                            <tr>
                                <td><span class="label label-warning">Draft</span> @Model.LatestDraft.Draft</td>
                                <td>@Model.LatestDraft.Comment</td>
                                <td>@Model.LatestDraft.Added</td>
                                <td>@Html.ActionLink("download", "GetFile", "FileRevisions", new { id = Model.LatestDraft.Id }, null)</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="panel-group">
                <div class="panel panel-warning">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" href="#collapse1">All revisions</a> <span class="badge badge-light">@Model.RevisionsCount</span>
                        </h4>
                    </div>
                    <div id="collapse1" class="panel-collapse collapse">
                        @if (Model.RevisionsCount > 0)
                        {
                            <table class="table table-striped table-hover table-condensed">
                                <thead>
                                    <tr>
                                        <th style="font-weight:900; width:50px;" align="right">Rev</th>
                                        <th style="font-weight:900; width:250px;" align="right">Comment</th>
                                        <th style="font-weight:900; width:130px;" align="right">Added</th>
                                        <th style="font-weight:900; width:25px;" align="right"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{ int counter = 0;}
                                    @foreach (FileRevision rev in Model.Current.Revisions.OrderByDescending(a => a.Revision))
                                    {
                                        <tr>
                                            <td>
                                                @if (string.IsNullOrEmpty(rev.Draft))
                                                {
                                                    <span class="label label-success">issue</span>
                                                }
                                                else
                                                {
                                                    @rev.Draft
                                                }
                                            </td>
                                            <td>@rev.Comment</td>
                                            <td>@rev.Added</td>
                                            <td>@Html.ActionLink("download", "GetFile", "FileRevisions", new { id = rev.Id }, null)</td>
                                        </tr>
                                        counter++;
                                    }
                                </tbody>
                            </table>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    @section scripts
{
        <script>

        </script>
    }

