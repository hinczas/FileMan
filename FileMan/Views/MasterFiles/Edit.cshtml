@model FileMan.Models.ViewModels.MasterFileViewModel
@using FileMan.Models
@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/jqueryval")
@{
    ViewBag.Title = "File";
}

<style>
    .row {
        padding-top: 15px;
    }

    .col-md-3, .col-md-9 {
        padding: 0px;
    }

    .icon {
        max-width: 16px;
        max-height: 16px;
    }
</style>

<div class="col-md-12">
    <ol class="breadcrumb" style="margin-bottom:10px;">
        @if (@Model.Breadcrumbs != null || @Model.Breadcrumbs.Count() > 0)
        {
            for (int i = @Model.Breadcrumbs.Count() - 1; i >= 0; i--)
            {
                <li>@Html.ActionLink(Model.Breadcrumbs.ElementAt(i).Name, "Index", "Home", new { id = Model.Breadcrumbs.ElementAt(i).Id }, new { title = "Parent" })</li>
            }
        }
        <li class="active">@Model.Current.Name</li>
    </ol>
</div>

<div class="col-md-12">
    <div class="col-md-7" style="padding-left:0px; float:left;">
        <h3 style="margin-top:0;">
            <b>@Model.Current.Number</b> - @Model.DraftVersion - @Model.Current.Name
        </h3>
    </div>
    <div class="col-md-5" style="padding-left:0px; padding-right:0px; padding-bottom:8px;">        
        <div class="btn-group btn-group-sm pull-right" role="group">
            <button class="btn btn-sm btn-default" type="button" disabled>Move</button>
            <button class="btn btn-sm btn-default" type="button" disabled>Add draft</button>
            <button class="btn btn-sm btn-default" type="button" disabled>Promote</button>
        </div>
    </div>
</div>
<div class="col-md-12">
    <div class="panel panel-success">
        @using (Html.BeginForm("Edit", "MasterFiles", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post, new { @class = "form-horizontal", role = "form", enctype = "multipart/form-data" }))
        {
            @Html.AntiForgeryToken()
            <div class="panel-heading">
                <strong>Details</strong>
                <span style="float:right;">
                    @Html.ActionLink("Cancel", "Details", "MasterFiles", new { id = Model.Current.Id }, new { @class = "btn btn-sm btn-default", type = "button", style = "margin-top:-5px;" })
                    <input type="submit" value="Save" class="btn btn-sm btn-success" style="margin-top:-5px;" />
                </span>
            </div>
            <table class="table table-striped table-hover table-condensed">
                <thead>
                </thead>
                <tbody>
                    <tr>
                        <td style="font-weight:700; width:100px;" align="right">Name</td>
                        <td> <input type="text" class="form-control" name="Name" value="@Model.Current.Name" /></td>
                    </tr>
                    <tr>
                        <td style="font-weight:700; width:100px;" align="right">Description</td>
                        <td><span style="white-space: pre-line"><textarea rows="5" cols="10" class="form-control" name="Description" placeholder="Description...">@Model.Current.Description</textarea></span> </td>
                    </tr>
                    <tr>
                        <td style="font-weight:700; width:100px;" align="right">Comment</td>
                        <td><span style="white-space: pre-line"><textarea rows="3" cols="10" class="form-control" name="Comment" placeholder="Comment...">@Model.Current.Comment</textarea></span> </td>
                    </tr>
                </tbody>
            </table>
            <input type="hidden" name="Id" value="@Model.Current.Id" />
            <input type="hidden" name="Number" value="@Model.Current.Number" />
        }
    </div>

    <div class="panel panel-info">
        <div class="panel-heading">
            <h4 class="panel-title">
                Latest revisions
            </h4>
        </div>
        <table class="table table-striped table-hover table-condensed">
            <thead>
                <tr>
                    <th style="font-weight:900; width:50px;" align="right">Type</th>
                    <th style="font-weight:900; width:250px;" align="right">Comment</th>
                    <th style="font-weight:900; width:130px;" align="right">Added</th>
                    <th style="font-weight:900; width:25px;" align="right"></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="label label-success">Issue</span></td>
                    <td>@Model.LatestIssue.Comment</td>
                    <td>@Model.LatestIssue.Added</td>
                    <td>@Html.ActionLink("download", "GetFile", "FileRevisions", new { id = Model.LatestIssue.Id }, null)</td>
                </tr>
                <tr>
                    <td><span class="label label-warning">Draft</span></td>
                    <td>@Model.LatestDraft.Comment</td>
                    <td>@Model.LatestDraft.Added</td>
                    <td>@Html.ActionLink("download", "GetFile", "FileRevisions", new { id = Model.LatestDraft.Id }, null)</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="panel-group">
        <div class="panel panel-warning">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" href="#collapse1">All revisions</a> <span class="badge badge-light">@Model.RevisionsCount</span>
                </h4>
            </div>
            <div id="collapse1" class="panel-collapse collapse">
                @if (Model.RevisionsCount > 0)
                {
                    <table class="table table-striped table-hover table-condensed">
                        <thead>
                            <tr>
                                <th style="font-weight:900; width:50px;" align="right">Rev</th>
                                <th style="font-weight:900; width:250px;" align="right">Comment</th>
                                <th style="font-weight:900; width:130px;" align="right">Added</th>
                                <th style="font-weight:900; width:25px;" align="right"></th>
                            </tr>
                        </thead>
                        <tbody>
                            @{ int counter = 0;}
                            @foreach (FileRevision rev in Model.Current.Revisions.OrderByDescending(a => a.Revision))
                            {
                                <tr>
                                    <td>
                                        @if (string.IsNullOrEmpty(rev.Draft))
                                        {
                                            <span class="label label-success">issue</span>
                                        }
                                        else
                                        {
                                            @rev.Draft
                                        }
                                    </td>
                                    <td>@rev.Comment</td>
                                    <td>@rev.Added</td>
                                    <td>@Html.ActionLink("download", "GetFile", "FileRevisions", new { id = rev.Id }, null)</td>
                                </tr>
                                counter++;
                            }
                        </tbody>
                    </table>
                }
            </div>
        </div>
    </div>
</div>

@section scripts
{
    <script>

    </script>
}

